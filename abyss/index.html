<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Abyss Browser</title>

<style>
/* ------------------ BASE ------------------ */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
body { 
    background: #000; 
    color: #f0f0f0; 
    overflow: hidden;
}

/* STARFIELD CANVAS */
#starfield {
    position: fixed;
    inset: 0;
    z-index: -2;
}

/* ------------------ UI ------------------ */
#tab-bar {
    height: 48px;
    background: rgba(20,20,25,0.75);
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    padding: 0 10px;
    gap: 6px;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
}

.tab {
    padding: 8px 14px;
    background: #1a1a1f;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0.7;
    transition: 0.2s;
}
.tab.active {
    background: linear-gradient(to bottom right, #2b2b33, #1b1b20);
    opacity: 1;
    box-shadow: 0 0 10px rgba(80,80,255,0.3);
}
.close-tab-btn { font-size: 14px; cursor: pointer; opacity: 0.5; }
.close-tab-btn:hover { opacity: 1; }

#add-tab-btn {
    padding: 6px 10px;
    border-radius: 10px;
    background: #1d1d25;
    cursor: pointer;
    font-size: 20px;
    opacity: 0.7;
}
#add-tab-btn:hover { opacity: 1; }

#url-area {
    height: 50px;
    background: rgba(15,15,18,0.75);
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    padding: 0 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
}

#browser-url-bar {
    width: 100%;
    padding: 10px 16px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 15px;
    outline: none;
}
#browser-url-bar:focus {
    background: rgba(255,255,255,0.12);
}

#browser-view {
    width: 100%;
    height: calc(100vh - 98px);
    position: relative;
}

iframe {
    width: 100%;
    height: 100%;
    border: none;
}

.minimal-mode {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    flex-direction: column;
    animation: fadein 0.4s ease-in-out;
}

#start-title {
    font-size: 38px;
    margin-bottom: 30px;
    opacity: 0.8;
    letter-spacing: 2px;
}

#search-input {
    width: 42%;
    padding: 16px 24px;
    border-radius: 40px;
    border: none;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(12px);
    color: #fff;
    font-size: 18px;
    outline: none;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
    transition: 0.2s;
}
#search-input:focus {
    background: rgba(255,255,255,0.12);
}

/* ------------------ BACKGROUND PICKER ------------------ */
#bg-picker-btn {
    position: fixed;
    bottom: 22px;
    right: 22px;
    background: rgba(255,255,255,0.1);
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    backdrop-filter: blur(10px);
    transition: 0.2s;
}
#bg-picker-btn:hover { background: rgba(255,255,255,0.18); }

#bg-modal {
    position: fixed;
    bottom: 80px;
    right: 22px;
    width: 260px;
    background: rgba(15,15,18,0.95);
    backdrop-filter: blur(12px);
    border-radius: 14px;
    padding: 16px;
    display: none;
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

.bg-item {
    padding: 10px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: 0.2s;
}
.bg-item:hover {
    background: rgba(255,255,255,0.15);
}

@keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>

<body>

<!-- ⭐ STARFIELD BACKGROUND -->
<canvas id="starfield"></canvas>

<div id="tab-bar">
    <div id="add-tab-btn">+</div>
</div>

<div id="url-area">
    <input id="browser-url-bar" placeholder="Search or enter URL" />
</div>

<div id="browser-view" class="minimal-mode">
    <div id="start-title">Abyss</div>
    <input id="search-input" placeholder="Search the web privately..." />
</div>

<!-- ⭐ BACKGROUND BUTTON -->
<div id="bg-picker-btn">
    <!-- Simple SVG icon -->
    <svg width="26" height="26" fill="#fff" opacity="0.85">
        <circle cx="13" cy="13" r="10" stroke="white" stroke-width="2" fill="none"></circle>
        <circle cx="13" cy="13" r="4" fill="white"></circle>
    </svg>
</div>

<!-- ⭐ BACKGROUND PICKER MODAL -->
<div id="bg-modal">
    <div class="bg-item" data-bg="space">Space Stars</div>
    <div class="bg-item" data-bg="galaxy">Galaxy</div>
    <div class="bg-item" data-bg="nebula">Alone</div>
    <div class="bg-item" id="upload-bg">Upload Custom (URL)</div>
</div>

<script>
/* ------------------ STARFIELD ------------------ */
const canvas = document.getElementById("starfield");
const ctx = canvas.getContext("2d");
let w, h;

function resizeStarfield() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeStarfield);
resizeStarfield();

let stars = [];
for (let i = 0; i < 180; i++) {
    stars.push({
        x: Math.random() * w,
        y: Math.random() * h,
        size: Math.random() * 2,
        speed: Math.random() * 0.2 + 0.05
    });
}

function animateStars() {
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = "white";

    stars.forEach(s => {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        ctx.fill();
        s.y += s.speed;
        if (s.y > h) {
            s.y = 0;
            s.x = Math.random() * w;
        }
    });

    requestAnimationFrame(animateStars);
}
animateStars();

/* ------------------ BACKGROUND PICKER ------------------ */

const bgBtn = document.getElementById("bg-picker-btn");
const bgModal = document.getElementById("bg-modal");

bgBtn.onclick = () => {
    bgModal.style.display = bgModal.style.display === "block" ? "none" : "block";
};

const bgTemplates = {
    space: "", /* starfield = default */
    galaxy: "url('https://windowscustomization.com/wp-content/uploads/2019/10/The-Nebula.gif')",
    nebula: "url('https://images.unsplash.com/photo-1454789548928-9efd52dc4031?auto=format&fit=crop&w=1950&q=80')",
    dark: "ur('https://balancedlifeskills.com/wp-content/uploads/2014/09/black-background.jpg')"
};

document.querySelectorAll(".bg-item").forEach(item => {
    item.onclick = () => {
        const type = item.dataset.bg;
        if (type) {
            document.body.style.background = bgTemplates[type];
            document.body.style.backgroundSize = "cover";
        }

        if (item.id === "upload-bg") {
            let url = prompt("Enter image URL:");
            if (url) {
                document.body.style.background = `url('${url}') center/cover no-repeat`;
            }
        }

        bgModal.style.display = "none";
    };
});

/* ------------------ BROWSER LOGIC (unchanged) ------------------ */

let tabs = [];
let activeTabId = null;

const tabBar = document.getElementById('tab-bar');
const browserUrlBar = document.getElementById('browser-url-bar');
const browserView = document.getElementById('browser-view');
const searchInput = document.getElementById('search-input');

function renderTabs() {
    tabBar.innerHTML = '<div id="add-tab-btn">+</div>';
    tabs.forEach(tab => {
        const tabEl = document.createElement('div');
        tabEl.classList.add('tab');
        if (tab.id === activeTabId) tabEl.classList.add('active');
        tabEl.dataset.tabId = tab.id;
        tabEl.innerHTML = `<span>${tab.title}</span><span class="close-tab-btn">×</span>`;
        tabBar.insertBefore(tabEl, document.getElementById('add-tab-btn'));
    });
}

function addTab(url='about:blank', switchTo=true){
    const id = Date.now().toString(36);
    const newTab = { id, url, title: 'New Tab' };
    tabs.push(newTab);

    const iframe = document.createElement('iframe');
    iframe.id = `iframe-${id}`;
    iframe.src = 'about:blank';
    iframe.style.display = 'none';
    browserView.appendChild(iframe);

    if (url !== 'about:blank') loadContent(newTab);
    if (switchTo) switchTab(id);

    renderTabs();
}

function switchTab(id){
    activeTabId = id;
    browserView.querySelectorAll('iframe').forEach(f => f.style.display = 'none');
    const activeFrame = document.getElementById(`iframe-${id}`);
    if (activeFrame) activeFrame.style.display = 'block';

    browserUrlBar.value = tabs.find(t => t.id === id)?.url || '';
    browserView.classList.remove('minimal-mode');
    document.getElementById('start-title').style.display = 'none';
    document.getElementById('search-input').style.display = 'none';

    renderTabs();
}

function closeTab(id){
    const index = tabs.findIndex(t => t.id === id);
    if (index === -1) return;

    const wasActive = tabs[index].id === activeTabId;

    document.getElementById(`iframe-${id}`).remove();
    tabs.splice(index,1);

    if (wasActive && tabs.length > 0) {
        switchTab(tabs[tabs.length - 1].id);
    } else if (tabs.length === 0) {
        browserView.classList.add('minimal-mode');
        document.getElementById('start-title').style.display = 'block';
        document.getElementById('search-input').style.display = 'block';
    }

    renderTabs();
}

function loadContent(tab){
    const frame = document.getElementById(`iframe-${tab.id}`);
    if (!tab.url || tab.url === 'about:blank') return;

    if (tab.url.startsWith('http://') || tab.url.startsWith('https://')) {
        frame.src = `/s/embed.html#${tab.url}`;
        tab.title = (() => { try { return new URL(tab.url).hostname; } catch { return 'Search'; } })();
    } else {
        frame.src = tab.url;
        tab.title = tab.url.replace('.html','');
    }

    renderTabs();
}

function navigateToAddress(){
    let url = browserUrlBar.value.trim();
    if (!url) return;

    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        if (url.includes('.')) url = 'https://' + url;
        else url = `https://search.brave.com/search?q=${encodeURIComponent(url)}`;
    }

    const tab = tabs.find(t => t.id === activeTabId);
    if (tab) { tab.url = url; loadContent(tab); }
}

browserUrlBar.addEventListener('keydown', e => {
    if (e.key === 'Enter') navigateToAddress();
});

tabBar.addEventListener('click', e => {
    const tabEl = e.target.closest('.tab');
    const closeBtn = e.target.closest('.close-tab-btn');
    const addBtn = e.target.closest('#add-tab-btn');

    if (closeBtn && tabEl) {
        e.stopPropagation();
        closeTab(tabEl.dataset.tabId);
    } else if (tabEl) {
        switchTab(tabEl.dataset.tabId);
    } else if (addBtn) {
        addTab();
    }
});

searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
        let q = searchInput.value.trim();
        const isURL = q.includes('.') && !q.includes(' ');
        let url = isURL ? (q.startsWith('http') ? q : 'https://' + q)
                        : `https://search.brave.com/search?q=${encodeURIComponent(q)}`;

        if (tabs.length === 0) addTab(url,true);
        else {
            const tab = tabs.find(t => t.id === activeTabId);
            if (tab) { tab.url = url; loadContent(tab); }
        }

        browserView.classList.remove('minimal-mode');
        document.getElementById('start-title').style.display = 'none';
        document.getElementById('search-input').style.display = 'none';
    }
});
</script>

</body>
</html>
